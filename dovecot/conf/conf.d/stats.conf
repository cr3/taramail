# Dovecot statistics configuration
# Enable stats export for dovecot_exporter

# Configure stats service with inet listener for exporter
service stats {
  unix_listener stats-writer {
    mode = 0660
    user = vmail
  }

  inet_listener http {
    port = 9166
  }
}

# Enable detailed statistics collection
plugin {
  # Track per-command statistics
  stats_refresh = 30s
  stats_track_cmds = yes
}

metric imap_command {
  filter = event=imap_command_finished
  group_by = cmd_name tagged_reply_state
}

metric pop3_command {
  filter = event=pop3_command_finished
  group_by = cmd_name tagged_reply_state
}

metric smtp_command {
  filter = event=smtp_server_command_finished
  group_by = cmd_name status_code
}

metric mail_delivery {
  filter = event=mail_delivery_finished
}

metric auth_success {
  filter = event=auth_request_finished AND success=yes
}

metric auth_failure {
  filter = event=auth_request_finished AND success=no
}
